// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ItemStatus {
  NEEDED
  IN_CART
  BOUGHT
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  username     String        @unique
  password     String
  createdAt    DateTime      @default(now())

  memberships  Membership[]
  itemsAdded   Item[]        @relation("ItemAddedBy")
}

model Household {
  id           Int           @id @default(autoincrement())
  name         String
  joinCode     String        @unique
  createdAt    DateTime      @default(now())

  memberships  Membership[]
  items        Item[]
}

model Membership {
  id           Int        @id @default(autoincrement())
  userId       Int
  householdId  Int

  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  household    Household  @relation(fields: [householdId], references: [id], onDelete: Cascade)

  @@unique([userId, householdId])
}

model Item {
  id           Int        @id @default(autoincrement())
  name         String
  quantity     Int        @default(1)
  status       ItemStatus @default(NEEDED)
  unit         String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  householdId  Int
  addedById    Int?

  household    Household  @relation(fields: [householdId], references: [id], onDelete: Cascade)
  addedBy      User?      @relation("ItemAddedBy", fields: [addedById], references: [id], onDelete: SetNull)

  @@index([householdId, status])
}
